# config/tts.yaml
# Configuration unifi√©e du syst√®me TTS SuperWhisper V6

# ===================================================================
# SECTION PRINCIPALE
# ===================================================================
# Activation du handler Piper natif (performance optimale <120ms)
# Mettre √† `false` pour forcer l'utilisation du fallback Piper CLI.
enable_piper_native: true

# ===================================================================
# CONFIGURATION DES BACKENDS
# ===================================================================
backends:
  # üöÄ PHASE 3: Priorit√© 1 - Handler natif optimis√© (binding Python)
  piper_native_optimized:
    enabled: true
    model_path: "D:/TTS_Voices/piper/fr_FR-siwis-medium.onnx"
    model_config_path: "D:/TTS_Voices/piper/fr_FR-siwis-medium.onnx.json"
    device: "cuda:0"  # RTX 3090 d√©di√©e TTS
    speaker_id: 0
    target_latency_ms: 80  # Objectif optimis√© <80ms vs 120ms
    
  # üöÄ PHASE 3: Priorit√© 1bis - Handler daemon (pipeline asynchrone)
  piper_daemon:
    enabled: false  # Exp√©rimental, activer si binding Python indisponible
    model_path: "D:/TTS_Voices/piper/fr_FR-siwis-medium.onnx"
    executable_path: "piper/piper.exe"
    speaker_id: 0
    target_latency_ms: 50  # Objectif daemon <50ms
    daemon_port: 0         # Port automatique
    daemon_host: "127.0.0.1"
    max_retries: 3
    retry_delay: 1.0

  # Priorit√© 2: Fallback natif (CLI subprocess)
  piper_native:
    enabled: true
    model_path: "D:/TTS_Voices/piper/fr_FR-siwis-medium.onnx"
    model_config_path: "D:/TTS_Voices/piper/fr_FR-siwis-medium.onnx.json"
    device: "cuda:0"  # Pointera vers RTX 3090 apr√®s CUDA_VISIBLE_DEVICES
    speaker_id: 0
    target_latency_ms: 120

  # Priorit√© 2: Fallback fonctionnel (CPU)
  piper_cli:
    enabled: true
    model_path: "D:/TTS_Voices/piper/fr_FR-siwis-medium.onnx"
    executable_path: "piper/piper.exe" # Chemin vers l'ex√©cutable
    speaker_id: 0
    target_latency_ms: 1000

  # Priorit√© 3: Fallback Windows natif (CPU)
  sapi_french:
    enabled: true
    voice_name: "Microsoft Hortense Desktop"
    rate: 0      # Vitesse de -10 (lent) √† 10 (rapide)
    volume: 100  # Volume de 0 √† 100
    target_latency_ms: 2000

  # Priorit√© 4: Ultime filet de s√©curit√©
  silent_emergency:
    enabled: true
    log_level: "CRITICAL"
    alert_webhook: null # Optionnel: URL d'un webhook pour recevoir les alertes
    target_latency_ms: 5

# ===================================================================
# CONFIGURATION DES COMPOSANTS
# ===================================================================
# üöÄ PHASE 3: Cache LRU optimis√© pour textes r√©currents
cache:
  enabled: true
  max_size_mb: 200              # Augment√© pour plus de textes
  max_entries: 2000             # Limite nombre d'entr√©es
  ttl_seconds: 7200             # 2 heures (augment√©)
  eviction_policy: "LRU"        # Least Recently Used
  enable_compression: false     # Compression audio (optionnelle)
  enable_persistence: false     # Persistance sur disque (optionnelle)
  maintenance_interval_seconds: 300  # Maintenance toutes les 5min

# Disjoncteur pour isoler les backends d√©faillants
circuit_breaker:
  failure_threshold: 3 # Nombre d'√©checs avant d'ouvrir le circuit
  reset_timeout_seconds: 30 # Temps avant de retenter un appel

# Monitoring via Prometheus
monitoring:
  prometheus_enabled: true
  prometheus_port: 9090
  log_performance_metrics: true
  alert_on_fallback: true # Log une alerte si un fallback est utilis√©

# ===================================================================
# PARAM√àTRES AVANC√âS - PHASE 3 OPTIMISATIONS
# ===================================================================
advanced:
  # Fraction de VRAM allou√©e au processus TTS sur le GPU.
  # Laisser ~90% pour le LLM.
  gpu_memory_fraction: 0.1
  # Nombre de workers pour traiter les requ√™tes TTS en parall√®le
  async_workers: 2
  # üöÄ PHASE 3: Limite augment√©e pour textes longs
  max_text_length: 5000  # Augment√© de 1000 ‚Üí 5000 chars
  # Nettoyage automatique du texte (caract√®res non support√©s, etc.)
  sanitize_text: true
  # Param√®tres audio pour conversion PCM ‚Üí WAV
  sample_rate: 22050
  channels: 1
  
  # üöÄ PHASE 3: Configuration chunking intelligent
  text_chunking:
    enabled: true
    max_chunk_length: 800          # S√©curit√© vs limite backend
    min_chunk_length: 50           # √âviter chunks trop courts
    overlap_chars: 20              # Chevauchement pour fluidit√©
    speech_rate_cps: 15.0          # Vitesse parole (chars/sec)
    inter_chunk_silence_ms: 200    # Pause entre chunks audio
  
  # üöÄ PHASE 3: Configuration GPU optimis√©e
  gpu_optimization:
    # R√©affectation GPU: STT sur cuda:1, TTS sur cuda:0
    tts_device: "cuda:0"           # RTX 3090 pour TTS
    stt_device: "cuda:1"           # RTX 4060 Ti pour STT
    enable_gpu_streams: true       # Streams d√©di√©s
    memory_pool_size_mb: 512       # Pool m√©moire GPU TTS

# ===================================================================
# FEATURE FLAGS (Pour d√©ploiement progressif)
# ===================================================================
feature_flags:
  # Flag principal pour activer le nouveau manager
  use_unified_tts: true
  # Flag pour forcer l'ancien mode (si un handler unique √©tait utilis√©)
  enable_legacy_mode: false 